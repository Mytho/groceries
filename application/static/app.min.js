/*!
 * Groceries v0.2.0
 * - - -
 * Copyright (c) 2014 Teun Zengerink
 * Released under MIT lisenced
 * https://raw.github.com/Mytho/groceries/master/LISENCE.md
 */
"use strict";var Groceries=angular.module("Groceries",[]);Groceries.config(["$interpolateProvider",function(a){a.startSymbol("[[").endSymbol("]]")}]),Groceries.factory("ItemModel",function(){return function(a){angular.extend(this,{id:null,name:"",created_by:null,created_date:null,bought_by:null,bought_date:null,isBought:function(){return!(!this.bought_by&&!this.bought_date)},update:function(a){angular.extend(this,a)}}),angular.extend(this,a)}}),Groceries.service("ItemService",["$http","$log","ItemModel",function(a,b,c){var d=function(a){var b,d;for(d=[],b=0;b<a.length;b++)d.push(new c(a[b]));return d};this.addItem=function(d){return a.post("/items",{name:d}).then(function(a){return new c(a.data)},function(){b.error("Could not add item")})},this.deleteItem=function(c){return a.delete("/items/"+c).then(function(a){return 200===a.status},function(){b.error("Could not delete item")})},this.toggleItem=function(d,e){return a.put("/items/"+d,{bought:e}).then(function(a){return new c(a.data)},function(){b.error("Could not toggle items")})},this.getGroceries=function(){return a.get("/items").then(function(a){return d(a.data)},function(){b.error("Could not load items")})},this.getSuggestions=function(){return a.get("/suggestions").then(function(a){return d(a.data)},function(){b.error("Could not load suggestions")})}}]),Groceries.controller("ListController",["$scope","$timeout","ItemService",function(a,b,c){a.groceries=[],a.inputFocused=!1,a.inputValue="",a.suggestions=[],a.visibleButtons=[],a.add=function(b){c.addItem(b).then(function(b){a.groceries.push(b),a.inputFocused=!1,a.inputValue=""})},a.buy=function(a,b){b.stopPropagation(),c.toggleItem(a.id,!a.isBought()).then(function(b){a.update(b)})},a.delete=function(b,d){d.stopPropagation(),c.deleteItem(b.id).then(function(){a.groceries.splice(a.groceries.indexOf(b),1)})},a.isButtonVisible=function(b){return a.visibleButtons.indexOf(b.id)>-1},a.keyup=function(c){13===c.keyCode&&(a.add(a.inputValue),b(function(){c.target.blur()},250))},a.toggleButton=function(b){a.visibleButtons.indexOf(b.id)>-1?a.visibleButtons.splice(a.visibleButtons.indexOf(b.id),1):a.visibleButtons.push(b.id)},a.toggleFocus=function(c){return a.inputFocused?void b(function(){a.inputFocused=!1,c.target.blur()},250):(a.inputFocused=!0,void c.target.focus())},a.removeFocus=function(){a.inputFocused&&b(function(){a.inputFocused=!1},250)},c.getGroceries().then(function(b){a.groceries=b}),c.getSuggestions().then(function(b){a.suggestions=b})}]);