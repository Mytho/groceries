/*!
 * Groceries v0.1.3
 * - - -
 * Copyright (c) 2013 T.Zengerink
 * Released under MIT lisenced
 * https://raw.github.com/Mytho/groceries/master/LISENCE.md
 */
(function(){var t,e,o,r,n={}.hasOwnProperty,i=function(t,e){function o(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};t=jQuery,o=document,r=window,e={Model:{},View:{},Collection:{},ajaxErrorHandler:function(t,e){return 401===e.status?r.location="login":void 0},init:function(){return t(o).ajaxError(e.ajaxErrorHandler),e.router=new e.Router,Backbone.history.start({pushState:!0}),setTimeout(function(){return r.scrollTo(0,1)},100)}},e.Router=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return i(o,t),o.prototype.routes={"":"home"},o.prototype.home=function(){return e.groceryView=new e.View.Grocery},o}(Backbone.Router),e.Model.Item=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return i(e,t),e.prototype.initialize=function(){return this.set("bought",this.get("bought_by")||this.get("bought_date"))},e.prototype.toggle=function(){return this.save({bought:!this.get("bought")})},e}(Backbone.Model),e.Model.Suggestion=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return i(e,t),e}(Backbone.Model),e.Collection.Grocery=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return i(o,t),o.prototype.model=e.Model.Item,o.prototype.url="/items",o.prototype.comparator=function(t){return t.get("create_date")},o}(Backbone.Collection),e.Collection.Suggestion=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return i(o,t),o.prototype.filtered=[],o.prototype.model=e.Model.Suggestion,o.prototype.url="/suggestions",o.prototype.comparator=function(t){return-t.get("count")},o.prototype.clear=function(){return this.filtered=[]},o.prototype.like=function(t){return this.filtered=this.filter(function(e){return-1!==e.get("name").toLowerCase().indexOf(t.toLowerCase())})},o}(Backbone.Collection),e.View.Grocery=function(o){function r(){return r.__super__.constructor.apply(this,arguments)}return i(r,o),r.prototype.el=t("div#content"),r.prototype.groceries=t("ul#groceries"),r.prototype.input=t("input#new-item"),r.prototype.suggestions=t("ul#suggestions"),r.prototype.events={"keyup input#new-item":"onKeyUp"},r.prototype.addAll=function(){return e.groceries.each(this.addOne,this)},r.prototype.addOne=function(o){var r;return r=new e.View.Item({model:o}),t(this.el).find("ul#groceries").append(r.render().el)},r.prototype.create=function(){return e.groceries.create({name:this.input.val()}),this.input.val(""),this.groceries.show(),this.suggestions.hide()},r.prototype.initialize=function(){return e.groceries=new e.Collection.Grocery,e.suggestions=new e.Collection.Suggestion,this.listenTo(e.groceries,"add",this.addOne),this.listenTo(e.groceries,"reset",this.addAll),e.groceries.fetch(),e.suggestions.fetch()},r.prototype.onKeyUp=function(t){return 13===t.keyCode&&""!==this.input.val()&&this.create(),13!==t.keyCode?this.suggest():void 0},r.prototype.suggest=function(){var o;return o=this,this.suggestions.html("").show(),""!==this.input.val()&&e.suggestions.like(this.input.val()),""===this.input.val()&&e.suggestions.clear(),_.each(e.suggestions.filtered,function(r){var n;return n=new e.View.Suggestion({model:r}),t(o.suggestions).append(n.render().el)}),e.suggestions.filtered.length&&this.groceries.hide(),""===this.input.val()?this.groceries.show():void 0},r}(Backbone.View),e.View.Item=function(e){function o(){return o.__super__.constructor.apply(this,arguments)}return i(o,e),o.prototype.tagName="li",o.prototype.events={click:"toggleDeleteButton","click label":"toggleBought","click .buy":"toggleBought","click .delete":"delete"},o.prototype["delete"]=function(){return this.model.destroy()},o.prototype.initialize=function(){return this.template=_.template(t("#item-template").html()),this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove)},o.prototype.render=function(){return t(this.el).html(this.template(this.model.toJSON())),t(this.el).find(".delete").hide(),this},o.prototype.toggleDeleteButton=function(){return t(this.el).find(".delete").toggle()},o.prototype.toggleBought=function(e){return t(this.el).toggleClass("bought"),this.model.toggle(),e.stopPropagation()},o}(Backbone.View),e.View.Suggestion=function(o){function r(){return r.__super__.constructor.apply(this,arguments)}return i(r,o),r.prototype.tagName="li",r.prototype.events={click:"addItem"},r.prototype.addItem=function(){return e.groceries.create({name:this.model.get("name")}),t("ul#suggestions").hide(),t("ul#groceries").show(),t("input#new-item").val("")},r.prototype.initialize=function(){return this.template=_.template(t("#suggestion-template").html())},r.prototype.render=function(){return t(this.el).html(this.template(this.model.toJSON())),this},r}(Backbone.View)}).call(this);