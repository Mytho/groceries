/*!
 * Groceries v0.1.0
 * - - -
 * Copyright (c) 2013 T.Zengerink
 * Released under MIT lisenced
 * https://raw.github.com/Mytho/groceries/master/LISENCE.md
 */
var $,APP,doc,win,__hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};$=jQuery,doc=document,win=window,APP={Model:{},View:{},Collection:{}},APP.ajaxErrorHandler=function(e,t){if(t.status===401)return win.location="login"},APP.init=function(){return $(doc).ajaxError(APP.ajaxErrorHandler),APP.groceryList=new APP.Collection.Grocery,APP.suggestions=new APP.Collection.Suggestion,APP.groceryView=new APP.View.Grocery},APP.Model.Item=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.initialize=function(){return this.set("bought",this.get("bought_by")||this.get("bought_date"))},t.prototype.toggle=function(){return this.save({bought:!this.get("bought")})},t}(Backbone.Model),APP.Model.Suggestion=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(Backbone.Model),APP.Collection.Grocery=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.model=APP.Model.Item,t.prototype.url="/items",t.prototype.comparator=function(e){return e.get("bought_date")},t}(Backbone.Collection),APP.Collection.Suggestion=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.filtered=[],t.prototype.model=APP.Model.Suggestion,t.prototype.url="/suggestions",t.prototype.comparator=function(e){return e.get("id")},t.prototype.clear=function(){return this.filtered=[]},t.prototype.like=function(e){return this.filtered=this.filter(function(t){return t.get("name").toLowerCase().indexOf(e.toLowerCase())!==-1})},t}(Backbone.Collection),APP.View.Grocery=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.el=$("div#content"),t.prototype.groceries=$("ul#groceries"),t.prototype.input=$("input#new-item"),t.prototype.suggestions=$("ul#suggestions"),t.prototype.events={"keyup input#new-item":"createOnEnter"},t.prototype.addAll=function(){return APP.groceryList.each(this.addOne,this)},t.prototype.addOne=function(e){var t;return t=new APP.View.Item({model:e}),$(this.el).find("ul#groceries").append(t.render().el)},t.prototype.createOnEnter=function(e){this.renderSuggestions();if(e.keyCode!==13||this.input.val()==="")return;return APP.groceryList.create({name:this.input.val()}),this.input.val("")},t.prototype.initialize=function(){return this.listenTo(APP.groceryList,"add",this.addOne),this.listenTo(APP.groceryList,"reset",this.addAll),APP.groceryList.fetch(),APP.suggestions.fetch()},t.prototype.renderSuggestions=function(){var e;e=this,this.suggestions.html(""),this.input.val()!==""&&APP.suggestions.like(this.input.val()),this.input.val()===""&&APP.suggestions.clear(),_.each(APP.suggestions.filtered,function(t){var n;return n=new APP.View.Suggestion({model:t}),$(e.suggestions).append(n.render().el)}),APP.suggestions.filtered.length&&this.groceries.hide();if(this.input.val()==="")return this.groceries.show()},t}(Backbone.View),APP.View.Item=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.tagName="li",t.prototype.events={click:"toggleDeleteButton","click label":"toggleBought","click .bought":"toggleBought","click .delete":"delete"},t.prototype["delete"]=function(){return this.model.destroy()},t.prototype.initialize=function(){return this.template=_.template($("#item-template").html()),this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove)},t.prototype.render=function(){return $(this.el).html(this.template(this.model.toJSON())),$(this.el).find(".delete").hide(),this},t.prototype.toggleDeleteButton=function(){return $(this.el).find(".delete").toggle()},t.prototype.toggleBought=function(e){return this.model.toggle(),e.stopPropagation()},t}(Backbone.View),APP.View.Suggestion=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.tagName="li",t.prototype.events={click:"addItem"},t.prototype.addItem=function(){return APP.groceryList.create({name:this.model.get("name")}),$("ul#suggestions").hide(),$("ul#groceries").show()},t.prototype.initialize=function(){return this.template=_.template($("#suggestion-template").html())},t.prototype.render=function(){return $(this.el).html(this.template(this.model.toJSON())),this},t}(Backbone.View);