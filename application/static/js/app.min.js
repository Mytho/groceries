/*!
 * Groceries v0.1.3
 * - - -
 * Copyright (c) 2013 T.Zengerink
 * Released under MIT lisenced
 * https://raw.github.com/Mytho/groceries/master/LISENCE.md
 */
(function(){var t,e,o,r={}.hasOwnProperty,n=function(t,e){function o(){this.constructor=t}for(var n in e)r.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};t=jQuery,e=document,o=window,o.APP={Model:{},View:{},Collection:{},ajaxErrorHandler:function(t,e){return 401===e.status?o.location="login":void 0},init:function(){return t(e).ajaxError(APP.ajaxErrorHandler),APP.router=new APP.Router,Backbone.history.start({pushState:!0}),setTimeout(function(){return o.scrollTo(0,1)},100)}},APP.Router=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.routes={"":"home"},e.prototype.home=function(){return APP.groceryView=new APP.View.Grocery},e}(Backbone.Router),APP.Model.Item=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.initialize=function(){return this.set("bought",this.get("bought_by")||this.get("bought_date"))},e.prototype.toggle=function(){return this.save({bought:!this.get("bought")})},e}(Backbone.Model),APP.Model.Suggestion=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e}(Backbone.Model),APP.Collection.Grocery=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.model=APP.Model.Item,e.prototype.url="/items",e.prototype.comparator=function(t){return t.get("create_date")},e}(Backbone.Collection),APP.Collection.Suggestion=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.filtered=[],e.prototype.model=APP.Model.Suggestion,e.prototype.url="/suggestions",e.prototype.comparator=function(t){return-t.get("count")},e.prototype.clear=function(){return this.filtered=[]},e.prototype.like=function(t){return this.filtered=this.filter(function(e){return-1!==e.get("name").toLowerCase().indexOf(t.toLowerCase())})},e}(Backbone.Collection),APP.View.Grocery=function(e){function o(){return o.__super__.constructor.apply(this,arguments)}return n(o,e),o.prototype.el=t("div#content"),o.prototype.groceries=t("ul#groceries"),o.prototype.input=t("input#new-item"),o.prototype.suggestions=t("ul#suggestions"),o.prototype.events={"keyup input#new-item":"onKeyUp"},o.prototype.addAll=function(){return APP.groceries.each(this.addOne,this)},o.prototype.addOne=function(e){var o;return o=new APP.View.Item({model:e}),t(this.el).find("ul#groceries").append(o.render().el)},o.prototype.create=function(){return APP.groceries.create({name:this.input.val()}),this.input.val(""),this.groceries.show(),this.suggestions.hide()},o.prototype.initialize=function(){return APP.groceries=new APP.Collection.Grocery,APP.suggestions=new APP.Collection.Suggestion,this.listenTo(APP.groceries,"add",this.addOne),this.listenTo(APP.groceries,"reset",this.addAll),APP.groceries.fetch(),APP.suggestions.fetch()},o.prototype.onKeyUp=function(t){return 13===t.keyCode&&""!==this.input.val()&&this.create(),13!==t.keyCode?this.suggest():void 0},o.prototype.suggest=function(){var e;return e=this,this.suggestions.html("").show(),""!==this.input.val()&&APP.suggestions.like(this.input.val()),""===this.input.val()&&APP.suggestions.clear(),_.each(APP.suggestions.filtered,function(o){var r;return r=new APP.View.Suggestion({model:o}),t(e.suggestions).append(r.render().el)}),APP.suggestions.filtered.length&&this.groceries.hide(),""===this.input.val()?this.groceries.show():void 0},o}(Backbone.View),APP.View.Item=function(e){function o(){return o.__super__.constructor.apply(this,arguments)}return n(o,e),o.prototype.tagName="li",o.prototype.events={click:"toggleDeleteButton","click label":"toggleBought","click .buy":"toggleBought","click .delete":"delete"},o.prototype["delete"]=function(){return this.model.destroy()},o.prototype.initialize=function(){return this.template=_.template(t("#item-template").html()),this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove)},o.prototype.render=function(){return t(this.el).html(this.template(this.model.toJSON())),t(this.el).find(".delete").hide(),this},o.prototype.toggleDeleteButton=function(){return t(this.el).find(".delete").toggle()},o.prototype.toggleBought=function(e){return t(this.el).toggleClass("bought"),this.model.toggle(),e.stopPropagation()},o}(Backbone.View),APP.View.Suggestion=function(e){function o(){return o.__super__.constructor.apply(this,arguments)}return n(o,e),o.prototype.tagName="li",o.prototype.events={click:"addItem"},o.prototype.addItem=function(){return APP.groceries.create({name:this.model.get("name")}),t("ul#suggestions").hide(),t("ul#groceries").show(),t("input#new-item").val("")},o.prototype.initialize=function(){return this.template=_.template(t("#suggestion-template").html())},o.prototype.render=function(){return t(this.el).html(this.template(this.model.toJSON())),this},o}(Backbone.View)}).call(this);