/*!
 * Groceries v0.2.0
 * - - -
 * Copyright (c) 2014 Teun Zengerink
 * Released under MIT lisenced
 * https://raw.github.com/Mytho/groceries/master/LISENCE.md
 */
"use strict";var Groceries=angular.module("Groceries",["ngTouch"]);Groceries.config(["$interpolateProvider",function(a){a.startSymbol("[[").endSymbol("]]")}]),Groceries.directive("swipeDelete",["$swipe",function(a){return{restrict:"A",scope:{label:"=swipeDelete"},link:function(b,c){var d={};c.addClass("swipe-delete"),c.append('<span class="swipe-delete-overlay"><span class="swipe-delete-overlay-label">'+b.label+"</span></span>"),d.move=function(a){var b=a.x-c[0].offsetLeft;b>c[0].clientWidth&&(b=c[0].clientWidth),c.addClass("swipe-delete-active"),c.find("span").css("width",b+"px")},d.end=function(){c.removeClass("swipe-delete-active"),c.find("span").css("width","")},a.bind(c,d)}}}]),Groceries.factory("InputModel",["$timeout",function(a){var b={};return b.isFocused=!1,b.value="",b.blur=function(b){this.isFocused=!1,a(function(){b&&b.blur()},250)},b.focus=function(b){this.isFocused=!0,a(function(){b.focus()},250)},b.onBlur=function(a){a.preventDefault(),a.stopPropagation()},b.onClick=function(a){a.preventDefault(),a.stopPropagation(),this.isFocused?this.blur(a.target):this.focus(a.target)},b.onFocus=function(a){a.preventDefault(),a.stopPropagation(),this.focus(a.target)},b.onKeyup=function(b){var c=this;b.preventDefault(),b.stopPropagation(),13===b.keyCode&&this.value&&(this.onEnter(this.value),this.value="",a(function(){c.blur(b.target)},250))},function(a){angular.extend(this,b),angular.extend(this,{onEnter:a})}}]),Groceries.factory("ItemModel",function(){return function(a){angular.extend(this,{id:null,name:"",created_by:null,created_date:null,bought_by:null,bought_date:null,isBought:function(){return!(!this.bought_by&&!this.bought_date)},update:function(a){angular.extend(this,a)}}),angular.extend(this,a)}}),Groceries.service("itemService",["$http","$log","ItemModel",function(a,b,c){var d=function(a){var b,d;for(d=[],b=0;b<a.length;b++)d.push(new c(a[b]));return d};this.addItem=function(d){return a.post("/items",{name:d}).then(function(a){return new c(a.data)},function(){b.error("Could not add item")})},this.deleteItem=function(c){return a.delete("/items/"+c).then(function(a){return 200===a.status},function(){b.error("Could not delete item")})},this.toggleItem=function(d,e){return a.put("/items/"+d,{bought:e}).then(function(a){return new c(a.data)},function(){b.error("Could not toggle items")})},this.getGroceries=function(){return a.get("/items").then(function(a){return d(a.data)},function(){b.error("Could not load items")})},this.getSuggestions=function(){return a.get("/suggestions").then(function(a){return d(a.data)},function(){b.error("Could not load suggestions")})}}]),Groceries.controller("ListController",["$log","$document","$scope","$timeout","itemService","InputModel",function(a,b,c,d,e,f){c.deleteSchedule={},c.inputModel=new f(function(a){c.add(a)}),c.groceries={list:[],append:function(a){c.groceries.list.push(a)},remove:function(a){c.groceries.list.splice(c.groceries.list.indexOf(a),1)},set:function(){e.getGroceries().then(function(a){c.groceries.list=a})}},c.suggestions={list:[],add:function(a,d){a.preventDefault(),a.stopPropagation(),c.inputModel.blur(b[0].getElementById("new-item")),c.add(d)},set:function(){e.getSuggestions().then(function(a){c.suggestions.list=a})}},c.add=function(a){e.addItem(a).then(function(a){c.groceries.append(a),c.suggestions.set()})},c.buy=function(a,b){a.preventDefault(),a.stopPropagation(),c.isScheduledForDelete(b)||e.toggleItem(b.id,!b.isBought()).then(function(a){b.update(a)})},c.cancelDelete=function(a,b){a.preventDefault(),a.stopPropagation(),d.cancel(c.deleteSchedule[b.id]),delete c.deleteSchedule[b.id]},c.delete=function(a,b){e.deleteItem(a.id).then(function(){c.groceries.remove(a),c.suggestions.set(),"function"==typeof b&&b()})},c.isScheduledForDelete=function(a){return c.deleteSchedule.hasOwnProperty(a.id)},c.scheduleDelete=function(a,b,e){a.preventDefault(),a.stopPropagation(),e=e||2500,c.deleteSchedule[b.id]=d(function(){c.delete(b,function(){delete c.deleteSchedule[b.id]})},e)},c.groceries.set(),c.suggestions.set()}]);